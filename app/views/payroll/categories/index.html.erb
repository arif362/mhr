<div class="row">
  <div class="header-wrapper">
    <h4>Payroll Category</h4>
  </div>

  <div class="content-body-wrapper">
    <div class="actions-button">
      <div class="clearfix">
        <div class="pull-right">
          <%= render 'new_category_button' %>
        </div>
        <div class="emplyee-select-form">
          <%= form_tag '', method: 'get' do %>
              <%= select_tag :employee, options_for_select(current_active_employees.collect { |emp| [emp.full_name, emp.id] }, params[:employee]), {class: 'custom-chosen form-control custom-label-select employee-change-select-submit', prompt: 'Select Employee To Setup Payroll'} %>
          <% end %>
        </div>
      </div>
    </div>
    <div class="content-body clearfix mt10" id="categories">
      <div class="clearfix mb15">
        <%= select_tag :export_to, options_for_select(AppSettings::EXPORT_TO.collect { |opt| [opt.camelize, opt] }), {class: 'form-control custom-export-to reset-border-radius pull-right', prompt: 'Export To....'} %>
      </div>
      <%= render 'payroll/categories/categories_table' %>
    </div>
  </div>
</div>

<script type="text/javascript">
    $(function () {
        $('.employee-change-select-submit').change(function () {
            if ($(this).val().length > 0) {
                $.ajax({
                    url: '/employees/' + $(this).val() + '/payroll_categories',
                    type: 'get',
                    dataType: 'script',
                    data: {tag: 'categories'}
                });
            }
        });

        $('#export_to').on('change', function () {
            var export_to = $(this).val();
            if (export_to == '<%= AppSettings::EXPORT_TO[0] %>') {
                window.location.href = '<%= payroll_categories_path('pdf') %>'
            }
            else if (export_to == '<%= AppSettings::EXPORT_TO[2] %>') {
                window.location.href = '<%= payroll_categories_path('docx') %>'
            }
            else if (export_to == '<%= AppSettings::EXPORT_TO[1] %>') {
                window.location.href = '<%= payroll_categories_path('xls') %>'
            }
        });
    });
</script>