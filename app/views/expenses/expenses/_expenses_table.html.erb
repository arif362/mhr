<table class="table action-table beaccount-table tablesorter table-responsive table-hover table-striped">
  <thead>
  <tr>
    <th>Category</th>
    <th>Subcategory</th>
    <th>Date</th>
    <th>Amount</th>
    <th>Voucher Number</th>
    <th>Status</th>
    <th>Attachment</th>
    <th></th>
  </tr>
  </thead>
  <tbody>
  <% total_amount = 0 %>
  <% @expenses.each do |expense| %>
      <tr>
        <td><%= expense.expense_category.name if expense.expense_category.present? %></td>
        <td><%= expense.expense_sub_category.name if expense.expense_sub_category.present? %></td>
        <td><%= format_date(expense.date) %></td>
        <% total_amount += expense.amount %>
        <td><%= expense.amount %></td>
        <td><%= expense.voucher_number %></td>
        <td>
          <%= expense.status.capitalize %>
        </td>
        <td>
          <% if expense.attachment_url.present? %>
              <% if expense.attachment.path.downcase.end_with?('.pdf', '.jpg', '.jpeg', '.gif', '.png') %>
                  <a href="javascript:void(0)" data-content="<%= expense.attachment_url %>" class="preview-attachment" id = "attachment_view">View</a>
              <% else %>
                  <%= link_to 'View', attachment_view_expenses_expense_path(expense.id) %>
              <% end %>
          <% else %>
              No Attachment
          <% end %>

        </td>
        <td>
          <% unless expense.status == AppSettings::REMARK_STATUS[:approved] %>
              <%= link_to 'Approve', approve_reject_expenses_expense_path(expense, is_approved: 'yes'), data: {confirm: "Are you sure you want to Approve this expense?"} %>
              <%= link_to 'Remark', new_remark_path(remarkable_object: expense, remarkable_type: expense.class.name), remote: true %>
          <% end %>
          <%= link_to expenses_expense_path(expense), class: 'btn info-color', remote: true do %>
              <i class="fa fa-eye"></i>
          <% end %>
          <%= link_to edit_expenses_expense_path(expense), class: 'btn warning-color', remote: true do %>
              <i class="fa fa-pencil"></i>
          <% end %>
          <%= link_to expenses_expense_path(expense), method: :delete, class: 'btn danger-color', data: {confirm: "Are you sure you want to delete this expense?"} do %>
              <i class="fa fa-times"> </i>
          <% end %>
        </td>
      </tr>
  <% end %>
  </tbody>
  <% if @expenses.length > 0 %>
      <tbody class="tablesorter-infoOnly">
      <tr>
        <td></td>
        <td></td>
        <td><b>Total</b></td>
        <td><b><%= total_amount %></b></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      </tbody>
  <% end %>
</table>

<script type="text/javascript">
    $(function(){
        $('.preview-attachment').attachmentPreview();
    });
</script>