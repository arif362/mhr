<div class="provident-fund-account-form">
  <%= form_for @account, html: {id: 'pf_account_form'} do |f| %>
      <% if @account.new_record? %>
          <div class="select-account-employee form-group">
            <div class="row">
              <div class="col-sm-10">
                <%= f.select :employee_id, options_for_select(@non_account_employee.collect { |emp| [emp.full_name, emp.id] }), {prompt: '~~ Select Employee ~~'}, class: 'form-control reset-border-radius' %>
              </div>
              <div class="col-sm-2">
                <i class="fa fa-info-circle btn btn-info pull-right reset-border-radius" data-toggle='popover' data-placement='top' title="Connect Employee To PF" data-content="Select employee to connect into provident fund"></i>
              </div>
            </div>
          </div>
      <% end %>
      <div class="form-inputs-container form-group <%= 'hidden' if @account.new_record? %>">
        <div class="row">
          <div class="col-sm-6" id="pf-employee-info">
            <div class="well profile-view clearfix">
              <%= render 'provident_fund/accounts/employee_profile', employee: @account.employee unless @account.new_record? %>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="form-group">
              <%= f.label :rule_id %>
              <%= f.select :rule_id, options_for_select(current_department.provident_fund_rules.collect { |rule| ["##{rule.id} Company #{rule.company_contribution}%, Employee #{rule.employee_contribution}%", rule.id] }), {prompt: 'Select PF Rule'}, {class: 'form-control', data: {required: true}} %>
            </div>
            <div class="form-group">
              <%= f.label :effective_date %>
              <%= f.text_field :effective_date, class: 'form-control datepicker' %>
            </div>
            <div class="actionss clearfix">
              <%= f.submit class: 'btn btn-default pull-right' %>
              <%= link_to 'Delete Account', provident_fund_account_path(@account), method: :delete, class: 'btn btn-danger pull-right mr10', data: {confirm: 'Are you sure?'} unless @account.new_record? %>
            </div>
          </div>
        </div>
      </div>
  <% end %>
</div>

<script type="text/javascript">
    $(function () {
        $('#pf_account_form').syftValidator();
        $('.add-policy-link').click(function () {
            time = new Date().getTime();
            regexp = new RegExp($(this).data('id'), 'g');
            $('.return-policy-wrapper').append($(this).data('fields').replace(regexp, time));
            event.preventDefault()
        });

        $('#provident_fund_account_employee_id').change(function () {
            var employeeId = $(this).val();
            if (employeeId == '') {
                $('.form-inputs-container').addClass('hidden');
            }
            else {
                $.ajax({
                    url: '/provident_fund/accounts/employee?employee_id=' + employeeId,
                    type: 'get',
                    dataType: 'script',
                    error: function () {
                        alert('Something wrong please try again!');
                    },
                    success: function () {
                        $('.form-inputs-container').removeClass('hidden');
                    }
                });
            }
        });

        $(document).on('click', '.remove-policy', function () {
            var policyItem = $(this).parents('.policy-list-item');
            var deleteMarkedField = policyItem.find('.removable');
            if (deleteMarkedField.length > 0) {
                deleteMarkedField.val(1);
            }
            policyItem.hide();
            return false;
        });

        $('input.datepicker').daterangepicker({
            singleDatePicker: true,
            showDropdowns: true,
            locale: {
                format: 'YYYY-MM-DD'
            }
        })
    });
</script>