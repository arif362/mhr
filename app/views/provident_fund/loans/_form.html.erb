<div class="provident-fund-loan-form clearfix">
  <div class="clearfix employee-contribution success-color">

  </div>
  <%= form_for @provident_fund_loan, html: {id: 'provident_fund_loan_form'} do |f| %>
      <div class="row clearfix">
        <div class="col-lg-12 clearfix">
          <div class="row clearfix">
            <div class="col-sm-6">
              <div class="form-group">
                <%= f.label :pf_account_id, 'PF Account' %>
                <%= f.select :pf_account_id, options_for_select(ProvidentFund::Account.all.collect { |pf| [pf.employee.full_name, pf.id] }), {prompt: 'Select PF Account'}, {class: 'form-control', data: {required: true}} %>
              </div>

              <div class="form-group">
                <%= f.label :amount, 'Loan Amount' %>
                <%= f.number_field :amount, class: 'form-control', data: {required: true} %>
              </div>

              <div class="form-group">
                <%= f.label :description, 'Description' %>
                <%= f.text_area :description, class: 'form-control', data: {required: true} %>
              </div>
            </div>
            <div class="col-sm-6">

              <div class="form-group">
                <%= f.label :return_policy %>
                <%= f.select :return_policy, options_for_select(AppSettings::ADVANCE_TYPES.collect { |key, value| [value] }, @provident_fund_loan.return_policy), {prompt: 'Select Return Policy'}, {class: 'form-control', data: {required: true}} %>
              </div>

              <div class="form-group input_loan_installment">
                <%= f.label :installment, 'Installment' %>
                <%= f.text_field :installment, class: 'form-control' %>
              </div>

              <div class="form-group">
                <%= f.label :date, 'Loan Date' %>
                <%= f.text_field :date, class: 'form-control datepicker', data: {required: true}, autocomplete: 'off' %>
              </div>

              <div class="form-group">
                <%= f.label :return_date %>
                <%= f.text_field :return_date, class: 'form-control datepicker', data: {required: true}, autocomplete: 'off' %>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="actions clearfix">
        <%= f.submit class: 'btn btn-default pull-right' %>
      </div>
  <% end %>
  <div class="form-loan-history">
  </div>
</div>

<script type="text/javascript">
    $(function () {
        $('#provident_fund_loan_form').syftValidator();
        $('#provident_fund_loan_date').datetimepicker({
            format: 'YYYY-MM-DD'
        });

        $('#provident_fund_loan_return_date').datetimepicker({
            format: 'YYYY-MM-DD',
            minDate: '<%= Date.today %>'
        });

        $('#provident_fund_loan_return_policy').change(function () {
            if ($(this).val() == 'installment' || $(this).val() == 'Installment') {
                $('.input_loan_installment').show();
            }
            else {
                $('.input_loan_installment').val('').hide();
            }
        });

        $('#provident_fund_loan_pf_account_id').change(function () {
            if ($(this).val() != '') {
                load_history($(this).val());
            }
            else {
                $('.form-loan-history').html('');
            }
        });

        if (<%= @provident_fund_loan.return_policy.present? && @provident_fund_loan.return_policy == AppSettings::ADVANCE_TYPES[:installment] %>) {
            $('.input_loan_installment').show();
        }

        if (<%= @provident_fund_loan.pf_account_id.present? %>) {
            load_history(<%= @provident_fund_loan.pf_account_id %>);
        }
    });

    function load_history(pf_account_id) {
        $.ajax({
            url: "/provident_fund/loans/history?pf_account_id=" + pf_account_id,
            type: 'get',
            error: function () {
                alert('unable to load history');
            }
        })
    }
</script>