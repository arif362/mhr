<div class="row reset-padding secondary-color">
  <div class="content-wrapper">

    <div class="header-wrapper">
      <h4>Employee Leave Status</h4>
    </div>

    <div class="content-body-wrapperx">
      <div class="content-body clearfix">

        <%= select_tag :export_to, options_for_select(AppSettings::EXPORT_TO.collect { |opt| [opt.camelize, opt] }), {class: 'form-control custom-export-to reset-border-radius pull-right', prompt: 'Export To....'} %>
        <div class="report-search-form mb15">
          <%= form_tag '', method: 'get', id: "leave-employee-status-form" do %>
              <%= select_tag :employee_id, options_for_select(current_active_employees.collect { |emp| [emp.full_name, emp.id] }, params[:employee_id].present? ? params[:employee_id] : current_employee.id), {class: 'custom-chosen form-control custom-label-select'} %>
              <%= select_year params[:date].present? ? params[:date][:year].to_i : Date.today, {:start_year => Date.today.year, :end_year => current_department.year}, {class: "form-control"} %>
              <%= submit_tag 'Search', class: 'primary-color-bg-with-hover reset-border-radius' %>
          <% end %>
        </div>

        <div class="table-warapper">
          <div class="table-warapper-body">
            <table class="table tablesorter beaccount-table table-responsive table-hover table-striped">
              <thead>
              <tr>
                <th>Category</th>
                <th>Total Application</th>
                <th>Approved</th>
                <th>Others</th>
                <th>Total Days</th>
                <th>Taken</th>
                <th>Paid</th>
                <th>Unpaid</th>
                <th>Remaining</th>
                <th></th>
              </tr>
              </thead>
              <tbody>
              <% @result.each do |category_id, value| %>
                  <tr>
                    <td>
                      <%= value[:category_name] %>
                    </td>
                    <td>
                      <%= value[:applied] %>
                    </td>
                    <td>
                      <%= value[:approved] %>
                    </td>
                    <td>
                      <%= value[:others] %>
                    </td>
                    <td>
                      <%= value[:days] %>
                    </td>
                    <td>
                      <%= value[:taken] %>
                    </td>
                    <td>
                      <%= value[:paid] %>
                    </td>
                    <td>
                      <%= value[:unpaid] %>
                    </td>
                    <td>
                      <%= value[:days] - value[:paid] %>
                    </td>
                    <td>
                      <% if value[:applied] > 0 %>
                          <a class="accordion-toggle" data-toggle="collapse" data-target="#leave-applications-of-<%= category_id %>" style="cursor: pointer">
                            <i class="secondary-guest-color fa fa-angle-double-down fz18" aria-hidden="true"></i>
                          </a>
                      <% end %>
                    </td>
                  </tr>

                  <% if value[:applied] > 0 %>
                      <tr class="inner-table-placement">
                        <td colspan="10" class="hidden-row">
                          <div class="accordian-body collapse pl20 pr20 text-left" id="leave-applications-of-<%= category_id %>">
                            <h4>Applied Applications of Category "<%= value[:category_name] %>"</h4>
                            <table class="table action-table inner-applications-table table-responsive table-hover table-striped">
                              <thead>
                              <tr>
                                <th>Dates</th>
                                <th>Days</th>
                                <th>Applied Date</th>
                                <th>Approved By</th>
                                <th>Status</th>
                                <th></th>
                              </tr>
                              </thead>
                              <tbody>
                              <% value[:applications].each do |leave_application| %>
                                  <tr>
                                    <td>
                                      <%= application_dates(leave_application) %>
                                    </td>
                                    <td><%= leave_application.total_days %></td>
                                    <td><%= format_date leave_application.created_at %></td>
                                    <td><%= 'jkdsg' %></td>
                                    <td><%= leave_application.status.capitalize %></td>
                                    <td></td>
                                  </tr>
                              <% end %>
                              </tbody>
                            </table>
                          </div>
                        </td>
                      </tr>
                  <% end %>

              <% end %>
              </tbody>
            </table>
            <div class="no-data-found">
              <% unless @result.present? %>
                  <%= render 'shared/no_data_found', message: 'No data found' %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
    $(function () {
        $('.accordian-body').on('show.bs.collapse', function () {
            $(this).closest("table")
                    .find(".collapse.in")
                    .not(this)
                    .collapse('toggle')
        });

        $('#export_to').on('change', function () {
            var export_to = $(this).val();
            if (export_to == '<%= AppSettings::EXPORT_TO[0] %>') {
                window.location.href = '<%= employee_status_leave_applications_path('pdf', params) %>'
            }
            else if (export_to == '<%= AppSettings::EXPORT_TO[2] %>') {
                window.location.href = '<%= employee_status_leave_applications_path('docx', params) %>'
            }
            else if (export_to == '<%= AppSettings::EXPORT_TO[1] %>') {
                window.location.href = '<%= employee_status_leave_applications_path('xls',  params) %>'
            }
        });

//        $('.accordion-toggle').click(function(){
//            if($(this).find('.fa-arrow-down').length > 0){
//                $(this).find('.fa-arrow-down').removeClass('fa-arrow-down').addClass('fa-arrow-up');
//            }
//            else{
//                $(this).find('.fa-arrow-up').removeClass('fa-arrow-up').addClass('fa-arrow-down');
//            }
//        });
    });
</script>
