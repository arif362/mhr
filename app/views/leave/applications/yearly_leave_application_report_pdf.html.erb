<div class="site-header">
  <div class="text-center">
    <h3> Leave Applications in a Year</h3>
  </div>
  <div class="text-center">
    <%= form_tag '', method: 'get', id: 'yearly-leave-report-form', remote: true do %>
        <%= select_year(params[:date].present? ? params[:date][:year].to_i : Date.today, :start_year => Date.today.year, :end_year => Date.today.year - 20) %>
    <% end %>
  </div>
</div>

<div class="panel table-warapper", id="application-report-table">
  <div class="table-warapper-body">
    <table class="table action-table beaccount-table tablesorter table-responsive table-hover table-striped">
      <thead>
      <tr class="trew">
        <th>Name</th>
        <th>Leave Type</th>
        <th>Total Days</th>
        <th>Days</th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      <% @leave_days_in_a_year.each do |leave_day| %>
          <tr>
            <td><%= leave_day.leave_application.employee.full_name %></td>
            <td><%= leave_day.leave_application.leave_category.name %></td>
            <td><%= leave_day.leave_application.total_days %></td>
            <% days = '' %>
            <% leave_day.leave_application.leave_days.each do |application_leave_day| %>
                <% if application_leave_day.is_approved %>
                    <% days = days.present? ? days + ', ' + application_leave_day.day.to_s : application_leave_day.day.to_s %>
                <% end %>
            <% end %>
            <td><%= days %></td>
            <td>
              <%= link_to leave_application_path(leave_day.leave_application, no_admin: true), remote: true do %>
                  <i class="fa fa-eye"> </i>
              <% end %>
            </td>
          </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</div>