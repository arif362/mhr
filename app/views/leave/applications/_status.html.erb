<div class="p10">
  <div class="create-leave-app-wrap">
    <div class="create-leave-app-container clearfix">
      <% if @employee == current_employee || current_employee.role == Employee::ROLE[:admin] %>
          <%= link_to new_leave_application_path(year: params[:date].present? ? params[:date][:year] : Date.today.year, employee: @employee.id), remote: true, class: 'btn btn-default pull-right reset-border-radius' do %>
              <i class="fa fa-plus"></i> New leave application
          <% end %>
      <% end %>
    </div>
  </div>
  <h3 class="text-center m0"><%= @employee.full_name %></h3>

  <div class="report-search-form ">
    <div class="">
      <%= form_tag leave_status_leave_applications_path, method: :get, class: 'clearfix', remote: true do %>
          <%#= label_tag 'Change Year : ' %>
          <%= select_year params[:date].present? ? params[:date][:year].to_i : Date.today, {start_year: Date.today.year, end_year: current_department.year}, {class: 'form-control pull-right', prompt: 'Select Year'} %>
          <%= hidden_field_tag 'employee_id', @employee.id %>
      <% end %>
    </div>
  </div>
  <div class="leave-table-wrap">
    <div class="leave-table-header">
      <h4><label>Leave Status</label></h4>
    </div>
    <div class="leave-status-table-wrap mb30">
      <table class="table tablesorter beaccount-table table-responsive table-hover table-striped">
        <thead>
        <tr>
          <th>Leave</th>
          <th>Total Day</th>
          <th>Taken</th>
          <th>Paid</th>
          <th>Unpaid</th>
          <th>Remaining</th>
        </tr>
        </thead>
        <tbody>
        <% @leave_categories.each do |category| %>
            <tr>
              <td><%= category.name %></td>
              <td><%= category.leave_category_years.first.days %></td>
              <td><%= taken = leave_taken(@leave_applications, category.id) %></td>
              <td><%= paid = paid_leave_taken(@leave_applications, category.id) %></td>
              <td><%= taken - paid %></td>
              <td><%= category.leave_category_years.first.days.to_i - paid %></td>
            </tr>
        <% end %>
        </tbody>
      </table>
      <div class="no-data-found">
        <% unless @leave_categories.present? %>
            <%= render 'shared/no_data_found', message: 'No leave catgory found' %>
        <% end %>
      </div>
    </div>
    <div class="leave-table-header">
      <h4><label>Leave Application</label></h4>
    </div>
    <div class="leave-app-table-wrap">
      <table class="table tablesorter action-table beaccount-table table-responsive table-hover table-striped employee-application-list">
        <thead>
        <tr>
          <th>Name</th>
          <th>Attachment</th>
          <th>Type</th>
          <th>Status</th>
          <th>Days</th>
          <th></th>
        </tr>
        </thead>
        <tbody id="leave-application-list">
        <% @leave_applications.each do |application| %>
            <%= render 'applied_list', application: application %>
        <% end %>
        </tbody>
      </table>
      <div id="pager2">
        <%= render 'shared/pagination' if @leave_applications.size > 10 %>
      </div>
      <div class="no-data-found">
        <% unless @leave_applications.present? %>
            <%= render 'shared/no_data_found', message: 'No leave application found' %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
    $(function () {
        $('.nav-item').click(function (e) {
            $('.nav-item').removeClass('active-white');
            $(this).addClass('active-white');
        });
        $('#date_year').change(function () {
            $(this).parents('form').submit();
        });

    });

    $(function () {
        if ($(".employee-application-list").find("tbody").find("tr").size() > 0) {
            $(".employee-application-list")
                    .tablesorter({
                        headers: {
                            5: {
                                sorter: false
                            }
                        },
                        widthFixed: true,
                        widgets: ['zebra']
                    })
                    .tablesorterPager({container: $("#pager2")});
        }
    });
</script>